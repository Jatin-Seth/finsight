<%- include('../layouts/header') %>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2>Add Transaction</h2>
    <div>
        <a href="/demo/portfolio/<%= portfolio._id %>" style="margin-right: 10px;">‚Üê Back to Portfolio</a>
        <a href="/demo/dashboard" style="margin-right: 10px;">Dashboard</a>
        <a href="/demo/logout">Logout</a>
    </div>
</div>

<div style="background-color: #e3f2fd; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
    <strong>Portfolio:</strong> <%= portfolio.name %>
    <span style="color: #666;">(<%= portfolio.currency || 'USD' %>)</span>
</div>

<% if (error) { %>
    <div class="alert alert-error">
        <%= error %>
    </div>
<% } %>

<div class="card">
    <form action="/demo/portfolio/<%= portfolio._id %>/transaction/add" method="POST">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">

            <div>
                <label for="symbol" style="display: block; margin-bottom: 5px; font-weight: 600;">Stock Symbol *</label>
                <input type="text" id="symbol" name="symbol" required placeholder="e.g., AAPL, GOOGL, TSLA"
                       style="text-transform: uppercase;" maxlength="10">
                <small style="color: #666; display: block; margin-top: 5px;">
                    Enter the stock ticker symbol
                </small>
            </div>

            <div>
                <label for="type" style="display: block; margin-bottom: 5px; font-weight: 600;">Transaction Type *</label>
                <select id="type" name="type" required>
                    <option value="">Select Transaction Type</option>
                    <option value="BUY">BUY - Purchase shares</option>
                    <option value="SELL">SELL - Sell shares</option>
                </select>
                <small style="color: #666; display: block; margin-top: 5px;">
                    Choose buy or sell transaction
                </small>
            </div>

        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">

            <div>
                <label for="qty" style="display: block; margin-bottom: 5px; font-weight: 600;">Quantity *</label>
                <input type="number" id="qty" name="qty" required min="0.001" step="0.001" placeholder="e.g., 100">
                <small style="color: #666; display: block; margin-top: 5px;">
                    Number of shares (decimals allowed)
                </small>
            </div>

            <div>
                <label for="price" style="display: block; margin-bottom: 5px; font-weight: 600;">Price per Share *</label>
                <div style="position: relative;">
                    <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #666;">$</span>
                    <input type="number" id="price" name="price" required min="0.01" step="0.01" placeholder="150.00"
                           style="padding-left: 25px;">
                </div>
                <small style="color: #666; display: block; margin-top: 5px;">
                    Price at which you bought/sold
                </small>
            </div>

        </div>

        <div id="transaction-summary" style="background-color: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 20px; display: none;">
            <h4 style="margin-top: 0; color: #2c3e50;">Transaction Summary</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div>
                    <strong>Symbol:</strong> <span id="summary-symbol">-</span>
                </div>
                <div>
                    <strong>Type:</strong> <span id="summary-type">-</span>
                </div>
                <div>
                    <strong>Quantity:</strong> <span id="summary-qty">-</span>
                </div>
                <div>
                    <strong>Price:</strong> $<span id="summary-price">-</span>
                </div>
                <div style="font-size: 1.1em;">
                    <strong>Total Value:</strong> $<span id="summary-total">0.00</span>
                </div>
            </div>
        </div>

        <div>
            <button type="submit" style="background-color: #4CAF50; margin-right: 10px;">
                Add Transaction
            </button>
            <a href="/demo/portfolio/<%= portfolio._id %>"
               style="background-color: #6c757d; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px;">
                Cancel
            </a>
        </div>
    </form>
</div>

<div style="margin-top: 30px; padding: 20px; background-color: #fff3cd; border-radius: 4px; border-left: 4px solid #ffc107;">
    <h4 style="margin-top: 0; color: #856404;">üí° Tips</h4>
    <ul style="color: #856404; margin-bottom: 0;">
        <li>Make sure to enter the correct stock symbol (e.g., AAPL for Apple Inc.)</li>
        <li>The price should be the actual price you paid/received per share</li>
        <li>For fractional shares, you can enter decimal quantities (e.g., 2.5)</li>
        <li>Double-check your transaction details before submitting</li>
    </ul>
</div>

<script>
    // Real-time transaction summary
    function updateSummary() {
        const symbol = document.getElementById('symbol').value.toUpperCase();
        const type = document.getElementById('type').value;
        const qty = parseFloat(document.getElementById('qty').value) || 0;
        const price = parseFloat(document.getElementById('price').value) || 0;
        const total = qty * price;

        if (symbol && type && qty && price) {
            document.getElementById('summary-symbol').textContent = symbol;
            document.getElementById('summary-type').textContent = type;
            document.getElementById('summary-qty').textContent = qty;
            document.getElementById('summary-price').textContent = price.toFixed(2);
            document.getElementById('summary-total').textContent = total.toFixed(2);
            document.getElementById('transaction-summary').style.display = 'block';
        } else {
            document.getElementById('transaction-summary').style.display = 'none';
        }
    }

    // Add event listeners
    document.getElementById('symbol').addEventListener('input', updateSummary);
    document.getElementById('type').addEventListener('change', updateSummary);
    document.getElementById('qty').addEventListener('input', updateSummary);
    document.getElementById('price').addEventListener('input', updateSummary);
</script>

<%- include('../layouts/footer') %>